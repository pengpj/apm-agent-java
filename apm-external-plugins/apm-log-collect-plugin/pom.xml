<?xml version="1.0" encoding="UTF-8"?>
<project xmlns="http://maven.apache.org/POM/4.0.0"
         xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"
         xsi:schemaLocation="http://maven.apache.org/POM/4.0.0 http://maven.apache.org/xsd/maven-4.0.0.xsd">
    <parent>
        <artifactId>apm-external-plugins</artifactId>
        <groupId>co.elastic.apm</groupId>
        <version>1.18.2-SNAPSHOT</version>
    </parent>
    <modelVersion>4.0.0</modelVersion>

    <artifactId>apm-log-collect-plugin</artifactId>
    <packaging>jar</packaging>
    <name>${project.groupId}:${project.artifactId}</name>

    <properties>
        <apm-agent-parent.base.dir>${project.basedir}/../..</apm-agent-parent.base.dir>
    </properties>

    <dependencies>

        <dependency>
            <groupId>${project.groupId}</groupId>
            <artifactId>apm-agent-plugin-sdk</artifactId>
            <version>${project.version}</version>
            <scope>provided</scope>
        </dependency>
        <dependency>
            <groupId>${project.groupId}</groupId>
            <artifactId>apm-agent-api</artifactId>
            <version>${project.version}</version>
        </dependency>

        <!--
        Example if you'd like to include a dependency:
        All external dependencies have to be included in the plugin jar.
        The maven shade plugin takes care of that (see build section of this file).
        As external plugins are loaded from an isolated class loader, you don't have to relocate the package names.
        <dependency>
            <groupId>org.apache.commons</groupId>
            <artifactId>commons-lang3</artifactId>
            <version>3.9</version>
        </dependency>
        -->

        <!-- Used for kafka log report-->
        <dependency>
            <groupId>org.apache.kafka</groupId>
            <artifactId>kafka-clients</artifactId>
            <version>1.1.1</version>
        </dependency>

        <dependency>
            <groupId>ch.qos.logback</groupId>
            <artifactId>logback-classic</artifactId>
            <version>1.2.3</version>
            <scope>provided</scope>
        </dependency>
        <dependency>
            <groupId>org.apache.logging.log4j</groupId>
            <artifactId>log4j-core</artifactId>
            <version>2.11.1</version>
            <scope>provided</scope>
        </dependency>
        <dependency>
            <groupId>log4j</groupId>
            <artifactId>log4j</artifactId>
            <version>1.2.17</version>
            <scope>provided</scope>
        </dependency>

        <!--
               A test dependency on the agent is needed so that the apm-api-plugin instruments apm-agent-api to inject the actual implementation.
               Not doing this will return noop transactions in the tests.
               -->
        <dependency>
            <groupId>${project.groupId}</groupId>
            <artifactId>apm-api-plugin</artifactId>
            <version>${project.version}</version>
            <scope>test</scope>
        </dependency>

        <!--
        The test-jar of the core plugin provides useful test helpers such as AbstractInstrumentationTest and MockReporter.
        -->
        <dependency>
            <groupId>${project.groupId}</groupId>
            <artifactId>apm-agent-core</artifactId>
            <type>test-jar</type>
            <version>${project.version}</version>
            <scope>test</scope>
        </dependency>

    </dependencies>

    <build>
        <plugins>
            <!--
            Currently, Byte Buddy has to be shaded in the same way the agent does.
            This will likely change in the future, making it required not to shade.
            -->
            <plugin>
                <artifactId>maven-shade-plugin</artifactId>
                <executions>
                    <execution>
                        <phase>package</phase>
                        <goals>
                            <goal>shade</goal>
                        </goals>
                        <configuration>
                            <shadedArtifactAttached>false</shadedArtifactAttached>
                            <relocations>
                                <relocation>
                                    <pattern>net.bytebuddy</pattern>
                                    <shadedPattern>co.elastic.apm.agent.shaded.bytebuddy</shadedPattern>
                                </relocation>
                                <relocation>
                                    <pattern>org.apache.kafka</pattern>
                                    <shadedPattern>co.elastic.apm.agent.shaded.log.collect.kafka</shadedPattern>
                                </relocation>
                                <relocation>
                                    <pattern>co.elastic.apm.plugin.log.collect.kafka</pattern>
                                    <shadedPattern>co.elastic.apm.agent.log.collect.kafka</shadedPattern>
                                </relocation>
                            </relocations>
                        </configuration>
                    </execution>
                </executions>
            </plugin>
        </plugins>
    </build>

</project>
